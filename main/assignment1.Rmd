---
title: "homework1"
author: "DingYuchen"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# simulate data

```{r}
i <- rep(1:1000,each=2)
k <- rep(1:2,times=1000)
x <- rep(c(0,1),times=1000)
# generate error
set.seed(1)
e <- evd::rgumbel(2000)
df <- as.data.frame(cbind(i,k,x,e))
# compute latent variable
beta <- 0.2
df$latent <- beta*df$x+df$e
```

# simulate consumer choice

```{r}
# generate choice variable
library(magrittr)
df <- df %>% 
  dplyr::group_by(i) %>%
  dplyr::mutate(y = as.integer(latent == max(latent))) %>%
  dplyr::ungroup()
head(df)
```

# compute likelidood

```{r}
beta_search <- seq(0,1,by=0.1)
likelihood <- c()
for (j in 1:length(beta_search)) {
  likelihood[j] <- Economics::loglikelihood_A1(b=beta_search[j])
}
likelihood <- as.data.frame(cbind(beta_search,likelihood))
save(likelihood,file = here::here("output\\assignment1\\likelihood_A1.RData"))
```

# plot likelihood

```{r}
library(ggplot2)
ggplot(likelihood,aes(beta_search,likelihood))+
  geom_point()+
  coord_cartesian()+
  labs(x= latex2exp::TeX("$\\beta$"), y= "Loglikelihood")
ggsave(here::here("figuretable\\assignment1\\loglikelihood.png"))
```

#  search optimal beta

```{r}
# search optimal beta on [-1,1] to maximize likelihood
optim(par = 0.2,
      fn = Economics::loglikelihood_A1,
      method = "Brent",
      control = list(fnscale=-1),
      lower = -1,
      upper = 1)
```